<!DOCTYPE html>
<html>
<head>
	<title>Hydrogel Diffusivity Calculator</title>

<!-- 	<link rel="stylesheet" href="stylesheets/style.css"> ! -->
</head>
<body>
	<h1>
		Hydrogel Diffusivity Calculator
	</h1>
	<p>
		This tool determines the diffusion constant or the mesh size of an ideal hydrogel system, given one value or the other. The calculations are based on the following equation: 
	</p>

	<script type="text/javascript" async
	  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
	</script>
	$$
    \frac{D}{D_o} =
    \left[erf\left(\frac{r_{FV}}{r_s}\right)exp\left(
    -\left(\frac{r_s}{r_{FVW}}\right)^3
    \left(\frac{\phi_p}{1-\phi_p}\right)\right)+
    erfc\left(\frac{r_{FV}}{r_s}\right)
    exp\left(-\pi\left(\frac{r_s+r_f}{\epsilon+2r_f}\right)^2\right)
    \right] 
    $$

	<p>
		This formula was derived by Eneko A. Iza and the Appel Group at Stanford University. The manuscript detailing this work is available
		<a href="http://www.supramolecularbiomaterials.com/pubs"><font color="#007BFF">here</font></a>. 
	</p>
	</p>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/6.2.0/math.min.js"></script>

	<form id=inputform>
		<table border="0" cellspacing="10" cellpadding="10" id="inputTable">
			<tr id="row1">
				<td>
					<label for="fluid">Fluid</label>
				</td>
				<td>
					<select id="fluid">
						<option value="water">Water</option>
						<option value="pbs">Phosphate Buffer Solution</option>
					</select>
				</td>
				<td>
					<label for="fluid">Polymer</label>
				</td>
				<td>
					<select id="polymer">
						<option value="pam">Polyacrilymide</option>
						<option value="peg">Polyethylene Glycol</option>
					</select>
				</td>
			</tr>
			<tr id="row2">
				<td>
					<label for="meshsize">Mesh Size</label>
				</td>
				<td>
					<input type="number" id=meshsize maxlength="8" onchange="calculate_hydrogel_property('diffusivity')">
				</td>
				<td>
					<label for="diffusivity">Diffusivity</label>
				</td>
				<td>
					<input type="number" id=diffusivity maxlength="8" onchange="calculate_hydrogel_property('mesh_size')">
				</td>
			</tr>
		</table>
	</form>
	<div>
		<button style="margin: 20px 10px" onclick="calculate_hydrogel_property('mesh_size')">Calculate Mesh Size</button>
		<button style="margin: 20px 10px" onclick="calculate_hydrogel_property('diffusivity')">Calculate Diffusivity</button>
	</div>
	


	<script>
		function calculate() {
			var input1 = parseInt(document.getElementById("input1").value);
			var input2 = parseInt(document.getElementById("input2").value);
			var output = input1 + input2;
			document.getElementById("output").value = output;
		};
	</script>

	<script>
		function calculate_hydrogel_property(property) {

			//Set all known variable values
			var r_FV = 2.69; // average radius of free-volume pockets in hydrogel
			var r_s = 1; // radius of solute
			var r_FVW = 2.69; // radius of free volume voids in water
			var phi_p = 1; // polymer volume fraction: ratio of polymer volume over total volume of hydrogel
			var T = 289; // temperature

			//Determine user-inputted values
			var r_f; // radius of polymer chain
			var nu; //dynamic viscosity
			var fluidObj = document.getElementById("fluid");
			var fluid = fluidObj.options[fluidObj.selectedIndex].value;
			var polymerObj = document.getElementById("polymer");
			var polymer = polymerObj.options[polymerObj.selectedIndex].value;

			//Extract dynamic viscosity value
			if (fluid == "water") {
				nu = 8.9*10**-4;
			} else if (fluid == "pbs") {
				nu = 10*10**-4;
			}

			//Extract polymer chain radius value
			if (polymer == "pam") {
				r_f = 8.8;
			} else if (polymer == "peg") {
				r_f = 5.1;
			}

			//Calculate diffusivity of solid hydrogel in liquid
			var D_o = calculate_diffusivity(r_s, nu, T);

			//Determine whether to calculate mesh size or diffusivity and then calculate
			if (property == "mesh_size") {
				var D = parseFloat(document.getElementById("diffusivity").value);
				var mesh_size = calculate_hydrogel_meshsize(D_o, r_FV, r_s, r_FVW, phi_p, r_f, D);
				document.getElementById("meshsize").value = mesh_size;
			} else {
				var mesh_size = parseFloat(document.getElementById("meshsize").value);
				var D = calculate_hydrogel_diffusivity(D_o, r_FV, r_s, r_FVW, phi_p, r_f, mesh_size);
				document.getElementById("diffusivity").value = D;
			}

		};
	</script>

	<script>
		//Calculate mesh size given diffusivity
		function calculate_hydrogel_meshsize(D_o, r_FV, r_s, r_FVW, phi_p, r_f, D) {
			var mesh_size;
			var A = (D/D_o-math.erf(r_FV/r_s)*Math.exp(-1*Math.pow(r_s/r_FVW, 3)*(phi_p/(1-phi_p))))/(1-math.erf(r_FV/r_s));
			console.log(A);
			mesh_size = (r_s+r_f)/Math.pow((-Math.log(A)/Math.PI),1/2)-2*r_f;
			console.log(mesh_size);
			return mesh_size.toPrecision(4)
		}
	</script>

	<script>
		//Calculate diffusivity given mesh size
		function calculate_hydrogel_diffusivity(D_o, r_FV, r_s, r_FVW, phi_p, r_f, mesh_size) {
			var D;
			D = D_o*(math.erf(r_FV/r_s)*Math.exp(-1*Math.pow(r_s/r_FVW, 3)*(phi_p/(1-phi_p))) + 
				1-math.erf(r_FV/r_s)*Math.exp(-Math.PI*Math.pow((r_s+r_f)/(mesh_size+2*r_f), 2)));
			return D.toPrecision(4);
		}
	</script>

	<script>
		//calculate diffusivity
		function calculate_diffusivity(r_s, nu, T) {
			var D_o;
			var k_b = 1.38064852*10**-23;
			D_o = k_b*T/(6*Math.PI*nu*r_s)
			return D_o
		}
	</script>
</body>
</html>